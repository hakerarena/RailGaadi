<div
  class="results-container"
  *ngIf="searchResults && searchResults.length > 0"
>
  <div class="results-header">
    <!-- <h2>Available Trains</h2> -->
    <div class="filter-options">
      <mat-form-field appearance="outline" class="sort-field">
        <mat-label>Sort By</mat-label>
        <mat-select [(value)]="sortBy" (selectionChange)="onSort(sortBy)">
          <mat-option value="departure">Departure Time</mat-option>
          <mat-option value="duration">Duration</mat-option>
          <mat-option value="fare">Fare</mat-option>
        </mat-select>
      </mat-form-field>
    </div>
  </div>

  <div class="train-cards">
    <mat-card class="train-card" *ngFor="let train of dataSource.data">
      <mat-card-header>
        <div class="train-header">
          <div class="train-basic-info">
            <h3>{{ train.trainNumber }} · {{ train.trainName }}</h3>
            <div class="running-days">
              Runs on:
              <span
                *ngFor="let day of train.runningDays"
                [class.active]="day"
                class="day-indicator"
              >
                {{ day }}
              </span>
            </div>
          </div>
        </div>
      </mat-card-header>

      <mat-card-content>
        <div class="journey-info">
          <div class="time-info departure">
            <div class="time">{{ train.departureTime }}</div>
            <div class="station">{{ train.source }}</div>
            <div class="date">Day 1</div>
          </div>

          <div class="journey-duration">
            <div class="duration-line">
              <mat-icon>arrow_forward</mat-icon>
            </div>
            <div class="duration-text">{{ train.duration }}</div>
          </div>

          <div class="time-info arrival">
            <div class="time">{{ train.arrivalTime }}</div>
            <div class="station">{{ train.destination }}</div>
            <div class="date">
              Day {{ getDayDifference(train.departureTime, train.arrivalTime) }}
            </div>
          </div>
        </div>

        <div class="class-availability">
          <!-- Show flexible date options if enabled -->
          <div
            *ngIf="
              isFlexibleSearch && getAvailableDatesForTrain(train).length > 0
            "
            class="flexible-dates"
          >
            <h4>Available Dates</h4>
            <div class="date-options">
              <div
                *ngFor="let date of getAvailableDatesForTrain(train)"
                class="date-option"
              >
                <div class="date-header">
                  <span class="date-label">{{ formatDate(date) }}</span>
                  <span class="date-full">{{ date.toDateString() }}</span>
                </div>
                <div class="class-grid">
                  <div
                    class="class-card"
                    *ngFor="
                      let class of getClassAvailabilityForDate(train, date)
                    "
                  >
                    <div class="class-header">
                      <span class="class-name">{{ class.name }}</span>
                      <span class="class-code">({{ class.code }})</span>
                    </div>
                    <div
                      class="availability"
                      [class.available]="class.availableSeats > 0"
                    >
                      {{
                        class.availableSeats > 0
                          ? class.availableSeats + " seats"
                          : "Waiting List"
                      }}
                    </div>
                    <div class="fare">₹{{ class.fare }}</div>
                    <button
                      mat-stroked-button
                      color="primary"
                      class="book-button"
                    >
                      Book Now
                    </button>
                  </div>
                </div>
              </div>
            </div>
          </div>

          <!-- Regular class availability for non-flexible search -->
          <div *ngIf="!isFlexibleSearch" class="regular-classes">
            <div
              class="class-card"
              *ngFor="let class of train.availableClasses"
            >
              <div class="class-header">
                <span class="class-name">{{ class.name }}</span>
                <span class="class-code">({{ class.code }})</span>
              </div>
              <div
                class="availability"
                [class.available]="class.availableSeats > 0"
              >
                {{
                  class.availableSeats > 0
                    ? class.availableSeats + " seats"
                    : "Waiting List"
                }}
              </div>
              <div class="fare">₹{{ class.fare }}</div>
              <button mat-stroked-button color="primary" class="book-button">
                Book Now
              </button>
            </div>
          </div>
        </div>
      </mat-card-content>
    </mat-card>
  </div>

  <mat-paginator
    [pageSizeOptions]="[5, 10, 25]"
    [pageSize]="10"
    aria-label="Select page of trains"
  ></mat-paginator>
</div>

<div class="no-results" *ngIf="searchResults && searchResults.length === 0">
  <mat-icon>train</mat-icon>
  <h3>No trains found for this route</h3>
  <p>Try searching with different dates or stations</p>
</div>

<div *ngIf="searchResults?.length === 0" class="no-results">
  <p>No trains found for the selected route.</p>
</div>
